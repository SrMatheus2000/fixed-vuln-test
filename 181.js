function e(a,c,e,f,h){if(void 0===e&&(e=!1),void 0===f&&(f=!0),void 0===h&&(h=!0),e&&('function'==typeof e?e(c,0,a,c.path):g(c,0)),''===c.path){var i={newDocument:a};if('add'===c.op)return i.newDocument=c.value,i;if('replace'===c.op)return i.newDocument=c.value,i.removed=a,i;if('move'===c.op||'copy'===c.op)return i.newDocument=d(a,c.from),'move'===c.op&&(i.removed=a),i;if('test'===c.op){if(i.test=k(a,c.value),!1===i.test)throw new b.JsonPatchError('Test operation failed','TEST_OPERATION_FAILED',0,c,a);return i.newDocument=a,i}if('remove'===c.op)return i.removed=a,i.newDocument=null,i;if('_get'===c.op)return c.value=a,i;if(e)throw new b.JsonPatchError('Operation `op` property is not one of operations defined in RFC-6902','OPERATION_OP_INVALID',0,c,a);else return i}else{f||(a=l._deepClone(a));var j,o,p,q=c.path||'',r=q.split('/'),s=a,u=1,t=r.length;for(p='function'==typeof e?e:g;;){if(o=r[u],h&&'__proto__'==o)throw new TypeError('JSON-Patch: modifying `__proto_` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README');if(e&&void 0==j&&(void 0===s[o]?j=r.slice(0,u).join('/'):u==t-1&&(j=c.path),void 0!==j&&p(c,0,a,j)),u++,Array.isArray(s)){if('-'===o)o=s.length;else if(e&&!l.isInteger(o))throw new b.JsonPatchError('Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index','OPERATION_PATH_ILLEGAL_ARRAY_INDEX',0,c.path,c);else l.isInteger(o)&&(o=~~o);if(u>=t){if(e&&'add'===c.op&&o>s.length)throw new b.JsonPatchError('The specified index MUST NOT be greater than the number of elements in the array','OPERATION_VALUE_OUT_OF_BOUNDS',0,c.path,c);var i=n[c.op].call(c,s,o,a);if(!1===i.test)throw new b.JsonPatchError('Test operation failed','TEST_OPERATION_FAILED',0,c,a);return i}}else if(o&&-1!=o.indexOf('~')&&(o=l.unescapePathComponent(o)),u>=t){var i=m[c.op].call(c,s,o,a);if(!1===i.test)throw new b.JsonPatchError('Test operation failed','TEST_OPERATION_FAILED',0,c,a);return i}s=s[o]}}}